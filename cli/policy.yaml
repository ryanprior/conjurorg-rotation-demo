---
- !policy
  id: shared-secret-auth
  body:
    - !host helloworld
    - !group consumers

    - !variable helloworld-secret

    - !permit
      role: !host helloworld
      privileges:
        - read
        - update
      resource: !variable helloworld-secret 

    - !permit
      role: !group consumers
      privileges:
        - read
        - execute
      resource: !variable helloworld-secret

- !policy
  id: tomcat
  body:
    - !layer hosts
    - !host-factory
      layers: [ !layer hosts ]

- !policy
  id: webapp
  body:
    - !layer hosts
    - !host-factory
      layers: [ !layer hosts ]

- !grant
  role: !group shared-secret-auth/consumers
  members:
    - !layer tomcat/hosts
    - !layer webapp/hosts
